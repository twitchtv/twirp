<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Errors · Twirp</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Twirp clients always return errors that can be cast to `twirp.Error`."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Errors · Twirp"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twitchtv.github.io/twirp/index.html"/><meta property="og:description" content="Twirp clients always return errors that can be cast to `twirp.Error`."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/twirp/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/twirp/js/scrollSpy.js"></script><link rel="stylesheet" href="/twirp/css/main.css"/><script src="/twirp/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/twirp/"><h2 class="headerTitle">Twirp</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/twirp/docs/intro.html" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/twirp/docs/spec_v7.html" target="_self">Spec</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Beyond the basics</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/twirp/docs/intro.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/install.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/example.html">Usage Example</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Beyond the basics</h3><ul class=""><li class="navListItem"><a class="navItem" href="/twirp/docs/routing.html">Routing and Serialization</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/twirp/docs/errors.html">Errors</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/proto_and_json.html">Protobuf and JSON</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/hooks.html">Hooks and Interceptors</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/mux.html">Muxing Twirp services</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/headers.html">Custom HTTP Headers</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/command_line.html">Generator Flags</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/curl.html">cURL</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/version_matrix.html">Version Compatibility</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Formal specification</h3><ul class=""><li class="navListItem"><a class="navItem" href="/twirp/docs/spec_v5.html">Version 5 (Previous)</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/spec_v6.html">Version 6 (Archived)</a></li><li class="navListItem"><a class="navItem" href="/twirp/docs/spec_v7.html">Version 7 (Current)</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Errors</h1></header><article><div><span><p>Twirp clients always return errors that can be cast to <code>twirp.Error</code>.
Transport-level errors are wrapped as a <code>twirp.Error</code> with the <code>twirp.Internal</code> code.</p>
<p>Twirp server implementations can return <code>twirp.Error</code> or a regular <code>error</code>. Regular
errors are wrapped with the <code>twirp.Internal</code> code.</p>
<h3><a class="anchor" aria-hidden="true" id="twirperror-interface"></a><a href="#twirperror-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>twirp.Error interface</h3>
<pre><code class="hljs css language-go"><span class="hljs-keyword">type</span> Error <span class="hljs-keyword">interface</span> {
    Code() ErrorCode        <span class="hljs-comment">// identifies a valid error type</span>
    Msg() <span class="hljs-keyword">string</span>            <span class="hljs-comment">// free-form human-readable message</span>

    WithMeta(key <span class="hljs-keyword">string</span>, val <span class="hljs-keyword">string</span>) Error <span class="hljs-comment">// set metadata</span>
    Meta(key <span class="hljs-keyword">string</span>) <span class="hljs-keyword">string</span>                <span class="hljs-comment">// get metadata value</span>
    MetaMap() <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>            <span class="hljs-comment">// see all metadata</span>

    Error() <span class="hljs-keyword">string</span> <span class="hljs-comment">// as an error, should return "twirp error &lt;Code&gt;: &lt;Msg&gt;"</span>
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="error-codes"></a><a href="#error-codes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Error Codes</h3>
<p>See <a href="https://pkg.go.dev/github.com/twitchtv/twirp#ErrorCode">twirp.ErrorCode</a>
for valid types in the <code>twirp</code> package.</p>
<p>See <a href="/twirp/docs/spec_v7.html#error-codes">Errors Spec</a> for the protocol Error codes and HTTP status mapping.</p>
<h3><a class="anchor" aria-hidden="true" id="http-errors-from-intermediary-proxies"></a><a href="#http-errors-from-intermediary-proxies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTTP Errors from Intermediary Proxies</h3>
<p>Twirp Clients may receive HTTP responses with non-200 status
from different sources like proxies or load balancers. For example,
a &quot;503 Service Temporarily Unavailable&quot; body, which cannot be
deserialized into a Twirp error.</p>
<p>In those cases, generated Go clients will return <code>twirp.Error</code> with a code
depending on the HTTP status of the invalid response:</p>
<table>
<thead>
<tr><th>HTTP status code</th><th>Twirp Error Code</th></tr>
</thead>
<tbody>
<tr><td>3xx (redirects)</td><td>Internal</td></tr>
<tr><td>400 Bad Request</td><td>Internal</td></tr>
<tr><td>401 Unauthorized</td><td>Unauthenticated</td></tr>
<tr><td>403 Forbidden</td><td>PermissionDenied</td></tr>
<tr><td>404 Not Found</td><td>BadRoute</td></tr>
<tr><td>429 Too Many Requests</td><td>ResourceExhausted</td></tr>
<tr><td>502 Bad Gateway</td><td>Unavailable</td></tr>
<tr><td>503 Service Unavailable</td><td>Unavailable</td></tr>
<tr><td>504 Gateway Timeout</td><td>Unavailable</td></tr>
<tr><td>... other</td><td>Unknown</td></tr>
</tbody>
</table>
<p>Additional metadata is added to make it easy to identify intermediary errors:</p>
<ul>
<li><code>&quot;http_error_from_intermediary&quot;: &quot;true&quot;</code></li>
<li><code>&quot;status_code&quot;: string</code> (original status code on the HTTP response, e.g. <code>&quot;500&quot;</code>).</li>
<li><code>&quot;body&quot;: string</code> (original non-Twirp error response as string).</li>
<li><code>&quot;location&quot;: url-string</code> (only on 3xx responses, matching the <code>Location</code> header).</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="metadata"></a><a href="#metadata" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Metadata</h3>
<p>Arbitrary string metadata can be added to any error. For example, a service may return this:</p>
<pre><code class="hljs css language-go"><span class="hljs-keyword">if</span> unavailable {
    twerr := twirp.NewError(twirp.Unavailable, <span class="hljs-string">"taking a nap ..."</span>)
    twerr = twerr.WithMeta(<span class="hljs-string">"retryable"</span>, <span class="hljs-string">"true"</span>)
    twerr = twerr.WithMeta(<span class="hljs-string">"retry_after"</span>, <span class="hljs-string">"15s"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, twerr
}
</code></pre>
<p>The metadata is available on the client:</p>
<pre><code class="hljs css language-go"><span class="hljs-keyword">if</span> twerr.Code() == twirp.Unavailable {
    <span class="hljs-keyword">if</span> twerr.Meta(<span class="hljs-string">"retry_after"</span>) != <span class="hljs-string">""</span> {
        <span class="hljs-comment">// ... retry after twerr.Meta("retry_after")</span>
    }
}
</code></pre>
<p>Error metadata can only have string values. This is to simplify error parsing by clients.
If your service requires errors with complex metadata, you should consider adding client
wrappers on top of the auto-generated clients, or just include business-logic errors as
part of the Protobuf messages (add an error field to proto messages).</p>
<h3><a class="anchor" aria-hidden="true" id="writing-http-errors-outside-twirp-services"></a><a href="#writing-http-errors-outside-twirp-services" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing HTTP Errors outside Twirp services</h3>
<p>Twirp services can be <a href="/twirp/docs/mux.html">muxed with other HTTP services</a>. For consistent responses
and error codes <em>outside</em> Twirp servers, such as HTTP middleware, you can call <code>twirp.WriteError</code>.</p>
<p>The error is expected to satisfy a <code>twirp.Error</code>, otherwise it is wrapped with <code>twirp.InternalError</code>.</p>
<p>Usage:</p>
<pre><code class="hljs css language-go">rpc.WriteError(w, twirp.NewError(twirp.Unauthenticated, <span class="hljs-string">"invalid token"</span>))
</code></pre>
<p>To simplify <code>twirp.Error</code> composition, a few constructors are available, such as <code>NotFoundError</code>
and <code>RequiredArgumentError</code>. See <a href="https://godoc.org/github.com/twitchtv/twirp#Error">docs</a>.</p>
<p>With constructor:</p>
<pre><code class="hljs css language-go">rpc.WriteError(w, twirp.RequiredArgumentError(<span class="hljs-string">"user_id"</span>))
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/twirp/docs/routing.html"><span class="arrow-prev">← </span><span>Routing and Serialization</span></a><a class="docs-next button" href="/twirp/docs/proto_and_json.html"><span>Protobuf and JSON</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2021 Twitch Interactive, Inc.</section></footer></div></body></html>